#!/usr/bin/env ruby

unless ARGV.any?
  warn("usage #{$PROGRAM_NAME} <environment-names>")
  exit 1
end

def run_environment(name)
  script_path = File.dirname(__FILE__)

  cmd = [
    File.join(script_path, "run-scenarios"),
    File.join(script_path, "environments", name + ".yml"),
    "--",
    Dir[File.join(script_path, "scenarios", "*.yml")],
    Dir[File.join(script_path, "scenarios", name, "*.yml")]
  ].flatten

  warn("$ #{cmd.join(' ')}")
  system(*cmd)
end

ARGV.each do |environment_name|
  run_environment(environment_name)
end
