#!/bin/sh
# Creates / Updates page on given project's wiki with test results.
set -e

PROJECT_WIKI_URL=$1
PAGE_TITLE=$2
PAGE_CONTENT=$3

if [ -z "$CI_PROJECT_ACCESS_TOKEN" ] || [ -z "$PAGE_CONTENT" ]; then
    echo "Error: missing argument(s)\nUsage: $0 [PROJECT_WIKI_URL] [ENV_NAME] [PAGE_TITLE] [PAGE_CONTENT]\nRequired environment variable(s) - CI_PROJECT_ACCESS_TOKEN"
else
    curl -s --data "title=$PAGE_TITLE" --data-urlencode "content=Autogenerated by GitLab Performance Toolkit" --header "PRIVATE-TOKEN: $CI_PROJECT_ACCESS_TOKEN" $PROJECT_WIKI_URL
    curl -s --request PUT --data "title=$PAGE_TITLE" --data-urlencode "content=$PAGE_CONTENT" --header "PRIVATE-TOKEN: $CI_PROJECT_ACCESS_TOKEN" "$PROJECT_WIKI_URL/$(echo $PAGE_TITLE | sed 's/\//%2F/g')"
fi
