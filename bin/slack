#!/bin/sh
# Sends Slack notification MSG to CI_SLACK_WEBHOOK_URL (which needs to be set).
# ICON_EMOJI needs to be set to an icon emoji name (without the `:` around it).

MSG=$1
ICON_EMOJI=$2

if [ -z "$CI_SLACK_WEBHOOK_URL" ] || [ -z "$CI_SLACK_CHANNEL" ] || [ -z "$MSG" ] || [ -z "$ICON_EMOJI" ]; then
    echo "Missing argument(s) - Use: $0 message icon_emoji"
    echo "and ensure the CI_SLACK_WEBHOOK_URL and CI_SLACK_CHANNEL environment variables are set."
else
    curl -X POST --data-urlencode 'payload={"channel": "#'"$CI_SLACK_CHANNEL"'", "username": "GitLab QA Bot", "text": "'"$MSG"'", "icon_emoji": "'":$ICON_EMOJI:"'"}' "$CI_SLACK_WEBHOOK_URL"
fi
